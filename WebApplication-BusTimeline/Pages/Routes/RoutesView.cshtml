@page
@model MapModel
@{
}
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		body {
			margin: 0;
			padding: 0;
			font-family: Arial, sans-serif;
		}

		.container {
			width: 100%;
			max-width: 1200px;
			margin: 0 auto;
			padding: 5px;
			box-sizing: border-box;
		}

	</style>
	<title>Responsive Design Example</title>
</head>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

<div class="mb-3" >
	<form method="get" action="/Routes/RoutesView">
		<label for="routeSelector">Prikaži liniju:</label>
		<select id="routeSelector" name="routeId" onchange="this.form.submit()">
			<option value="" disabled selected>Izaberite rutu</option>
			if(Model.Routes? != null){
					@foreach (var s in Model?.Routes)
					{
						<option value="@s.Id"> @s.Name</option>
					}
				}
		</select>
		<br />
	</form>
</div>

@if (Model.ErrorMessage != null)
{
	<div class="alert alert-danger" role="alert" style="margin-right: 625px;">
		<h7>@Model.ErrorMessage</h7>
	</div>

}

@if (Model.RouteId != null && string.IsNullOrEmpty(Model.ErrorMessage))
{
	<div><h7> Trenutno prikazana ruta je: @Model.RouteWithStop.Name </h7></div>
}

<div id="map" style="height: 600px;"></div>


<script>
	var map = L.map('map').setView([44.977300, 19.611058], 15);
	L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 19,
	}).addTo(map);

	function centerMapToMarker() {
		var markerLatLng = marker.getLatLng();
		map.setView(markerLatLng, 16);
	}

	var coordinates = [];
	var markers = [];

	@if(Model.RouteWithStop != null)
	{
		@for(int i=0; i<Model.RouteWithStop?.Stops.Count(); i++)
		{
			@:markers.push({ lat: "@Model.RouteWithStop.Stops[i].Stop.Lat.ToString().Replace(',','.')", lon: "@Model.RouteWithStop.Stops[i].Stop.Lon.ToString().Replace(',','.')" });
		}
	}

	@if (Model.Shapes != null )
	{
		@for (int i = 0; i < Model.Shapes?.Count(); i++)
		{
			@:coordinates.push({ lat: "@Model.Shapes[i].Lat.ToString().Replace(',','.')", lon: "@Model.Shapes[i].Lon.ToString().Replace(',','.')" });
		}
	}


		for (var i = 0; i < markers.length; i++) {
		var marker = L.marker([markers[i].lat, markers[i].lon]).addTo(map);
	}

	var busRoute = L.polyline(
		[coordinates],
		{
			color: 'red',
			weight: 3,
			opacity: 0.5,
			smoothFactor: 1,
		}).addTo(map);

	map.fitBounds(busRoute.getBounds());

</script>

<a href="../Index">Home</a>