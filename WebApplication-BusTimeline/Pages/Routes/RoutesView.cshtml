@page
@model MapModel
@{
}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

<div class="mb-3" >
	<form method="get" action="/Routes/RoutesView">
		<label for="routeSelector">Prikaži liniju:</label>
		<select id="routeSelector" name="routeId" onchange="this.form.submit()">
			<option value="" disabled selected>Izaberite rutu</option>
			if(Model.Routes? != null){
					@foreach (var s in Model?.Routes)
					{
						<option value="@s.Id"> @s.Name</option>
					}
				}
		</select>
		<br />
	</form>
</div>

@if (Model.ErrorMessage != null)
{
	<div class="alert alert-danger" role="alert" style="margin-right: 625px;">
		<h7>@Model.ErrorMessage</h7>
	</div>

}

@if (Model.RouteId != null && string.IsNullOrEmpty(Model.ErrorMessage))
{
	<div><h7> Trenutno prikazana ruta je: @Model.RouteWithStop.Name </h7></div>
}

<div id="map" style="height: 600px;"></div>


<script>
	var map = L.map('map').setView([44.968190, 19.608141], 12);
	L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 19,
	}).addTo(map);

	var coordinates = [];

	@if(Model.RouteWithStop != null)
	{
		@for(int i=0; i<Model.RouteWithStop?.Stops.Count(); i++)
		{
			@:coordinates.push({ lat: "@Model.RouteWithStop.Stops[i].Stop.Lat.ToString().Replace(',','.')", lon: "@Model.RouteWithStop.Stops[i].Stop.Lon.ToString().Replace(',','.')" });
		}
	}

	i=0; 
	while (i < coordinates.length) {
		console.log(coordinates[i]);
		i++;
	}

	DrawPolyline = [];

	L.polyline(
		[coordinates],
		{
			color: 'red',
			weight: 3,
			opacity: 0.5,
			smoothFactor: 1,
		}).addTo(map);


</script>

<a href="../Index">Home</a>